---
layout:     post
title:      多目标系列之二ESMM模型
subtitle:   ESMM模型详解
date:       2017-06-19
author:     BY
header-img: img/post-bg-universe.jpg
catalog: true
tags:
    - 机器学习
    - 多目标优化
    - ESMM
---

再上一篇[MMOE](http://yougth.top/2021/03/25/%E5%A4%9A%E7%9B%AE%E6%A0%87%E7%B3%BB%E5%88%97%E4%B9%8B%E4%B8%80MMOE%E6%A8%A1%E5%9E%8B/)中遗留下来一个问题，在多阶段多目标优化中，后面阶段转化必然要在前一阶段转化成功的基础上产生的，这两阶段的关系怎么建模到模型中，看看ESMM是怎么解决的。


ESMM原始论文是阿里2018年发在SIGIR上面，《[Entire Space Multi-Task Model: An Eﬀective Approach for Estimating Post-Click Conversion Rate](https://arxiv.org/abs/1804.07931)》，主要解决了两个问题，一个是上面提到的多阶段信息损失问题，另一个是后面阶段正样本偏少的问题，本质其实是一个问题。


### 模型背景

现在有一个电商场景位，运营说今年整体指标是GMV提升10%，从运营的角度可以拆解成客单价 x 成交订单数，这两个在算法的角度都是没法直接优化的，算法的角度是有一个推荐位用户每次来我可以给他曝光他最想买的商品，如果我把从曝光到转化的概率提升10%，那是不是可以完成目标了。

![转化漏斗](http://yougth.top/img/ml/ESMM_1.png)

这里涉及到一个转化漏斗，我们简化为给用户曝光 -> 用户点击 -> 用户购买，中间有两个转化状态，假设我们把整个转化率叫做$$P_{ctcvr}$$，涉及到模型上就是要预测用户对当前商品点击率$$P_{ctr}$$，和假设点击之后产生的转化率$$P_{cvr}$$，则公式定义为

$$
P_{ctcvr} = P_{cvr} · P_{ctr}
$$

对应到我们离线收集到的样本上，特征假设为x，点击假设为y，购买假设为z，转化后就是

$$
P(y\&z = 1 | x) = P(z = 1|y = 1,x) · P(y=1 | x)
$$

最终要预估的点击转化率对应样本就是购买的，点击率对应的是曝光后点击的，唯独中间转化率部分，我们根据公式定义可以看到前提是y = 1，即点击之后转化率，但是我们知道正常点击率是个10%不到，意味这大部分的样本没有产生点击，那么这部分的转化率就是个未知数，既然是未知数，对应到模型中就要是一个**参数变量**。

### 模型结构

原论文中的网络结果如下图所示，底层是embedding是共享的，和MMOE的Shared-Bottom结构差不多，这里为了突出是两个模型画了两个单独的塔，在中间写上了Shared Lookup Table，表示是共享embedding的，到上面Concatenate之后才是单独的各自网络，基本上所有创新点都在左侧塔上面pCVR红色的节点上，这里的意思是这是个参数，会随着模型训练不断的持续迭代学习，而绿色的点是明确的label。

![模型结构](http://yougth.top/img/ml/ESMM_0.png)

### 损失函数



### 总结


